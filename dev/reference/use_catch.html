<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Use Catch for C++ unit testing — use_catch • testthat</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Catch for C++ unit testing — use_catch"><meta name="description" content="Add the necessary infrastructure to enable C++ unit testing
in R packages with Catch and
testthat."><meta property="og:description" content="Add the necessary infrastructure to enable C++ unit testing
in R packages with Catch and
testthat."><meta property="og:image" content="https://testthat.r-lib.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="testthat.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">testthat</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.2.3.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/custom-expectation.html">Custom expectations</a></li>
    <li><a class="dropdown-item" href="../articles/parallel.html">Running tests in parallel</a></li>
    <li><a class="dropdown-item" href="../articles/skipping.html">Skipping tests</a></li>
    <li><a class="dropdown-item" href="../articles/snapshotting.html">Snapshot tests</a></li>
    <li><a class="dropdown-item" href="../articles/special-files.html">Special files</a></li>
    <li><a class="dropdown-item" href="../articles/test-fixtures.html">Test fixtures</a></li>
    <li><a class="dropdown-item" href="../articles/third-edition.html">testthat 3e</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2023/10/testthat-3-2-0/">Version 3.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/10/testthat-3-1/">Version 3.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/10/testthat-3-0-0/">Version 3.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/11/testthat-2-3-0/">Version 2.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/04/testthat-2-1-0/">Version 2.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2017/12/testthat-2-0-0/">Version 2.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://blog.rstudio.com/2016/04/29/testthat-1-0-0/">Version 1.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://blog.rstudio.com/2015/05/29/testthat-0-10-0/">Version 0.10.0</a></li>
    <li><a class="external-link dropdown-item" href="https://blog.rstudio.com/2014/09/23/testthat-0-9/">Version 0.9.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/testthat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Use Catch for C++ unit testing</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/testthat/blob/main/R/test-compiled-code.R" class="external-link"><code>R/test-compiled-code.R</code></a></small>
      <div class="d-none name"><code>use_catch.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Add the necessary infrastructure to enable C++ unit testing
in <span style="R">R</span> packages with <a href="https://github.com/catchorg/Catch2" class="external-link">Catch</a> and
<code>testthat</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">use_catch</span><span class="op">(</span>dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dir">dir<a class="anchor" aria-label="anchor" href="#arg-dir"></a></dt>
<dd><p>The directory containing an <span style="R">R</span> package.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Calling <code>use_catch()</code> will:</p><ol><li><p>Create a file <code>src/test-runner.cpp</code>, which ensures that the
<code>testthat</code> package will understand how to run your package's
unit tests,</p></li>
<li><p>Create an example test file <code>src/test-example.cpp</code>, which
showcases how you might use Catch to write a unit test,</p></li>
<li><p>Add a test file <code>tests/testthat/test-cpp.R</code>, which ensures that
<code>testthat</code> will run your compiled tests during invocations of
<code>devtools::test()</code> or <code>R CMD check</code>, and</p></li>
<li><p>Create a file <code>R/catch-routine-registration.R</code>, which ensures that
<span style="R">R</span> will automatically register this routine when
<code><a href="https://rdrr.io/r/tools/package_native_routine_registration_skeleton.html" class="external-link">tools::package_native_routine_registration_skeleton()</a></code> is invoked.</p></li>
</ol><p>You will also need to:</p><ul><li><p>Add xml2 to Suggests, with e.g. <code>usethis::use_package("xml2", "Suggests")</code></p></li>
<li><p>Add testthat to LinkingTo, with e.g.
<code>usethis::use_package("testthat", "LinkingTo")</code></p></li>
</ul><p>C++ unit tests can be added to C++ source files within the
<code>src</code> directory of your package, with a format similar
to <span style="R">R</span> code tested with <code>testthat</code>. Here's a simple example
of a unit test written with <code>testthat</code> + Catch:</p>
<div class="sourceCode"><pre><code>
context("C++ Unit Test") {
  test_that("two plus two is four") {
    int result = 2 + 2;
    expect_true(result == 4);
  }
}
</code></pre></div>

<p>When your package is compiled, unit tests alongside a harness
for running these tests will be compiled into your <span style="R">R</span> package,
with the C entry point <code>run_testthat_tests()</code>. <code>testthat</code>
will use that entry point to run your unit tests when detected.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>



<p>All of the functions provided by Catch are
available with the <code>CATCH_</code> prefix – see
<a href="https://github.com/catchorg/Catch2/blob/master/docs/assertions.md" class="external-link">here</a>
for a full list. <code>testthat</code> provides the
following wrappers, to conform with <code>testthat</code>'s
<span style="R">R</span> interface:</p>
<table class="table table"><tr><td><strong>Function</strong></td><td><strong>Catch</strong></td><td><strong>Description</strong></td></tr><tr><td><code>context</code></td><td><code>CATCH_TEST_CASE</code></td><td>The context of a set of tests.</td></tr><tr><td><code>test_that</code></td><td><code>CATCH_SECTION</code></td><td>A test section.</td></tr><tr><td><code>expect_true</code></td><td><code>CATCH_CHECK</code></td><td>Test that an expression evaluates to <code>true</code>.</td></tr><tr><td><code>expect_false</code></td><td><code>CATCH_CHECK_FALSE</code></td><td>Test that an expression evalutes to <code>false</code>.</td></tr><tr><td><code>expect_error</code></td><td><code>CATCH_CHECK_THROWS</code></td><td>Test that evaluation of an expression throws an exception.</td></tr><tr><td><code>expect_error_as</code></td><td><code>CATCH_CHECK_THROWS_AS</code></td><td>Test that evaluation of an expression throws an exception of a specific class.</td></tr></table><p>In general, you should prefer using the <code>testthat</code>
wrappers, as <code>testthat</code> also does some work to
ensure that any unit tests within will not be compiled or
run when using the Solaris Studio compilers (as these are
currently unsupported by Catch). This should make it
easier to submit packages to CRAN that use Catch.</p>
    </div>
    <div class="section level2">
    <h2 id="symbol-registration">Symbol Registration<a class="anchor" aria-label="anchor" href="#symbol-registration"></a></h2>



<p>If you've opted to disable dynamic symbol lookup in your
package, then you'll need to explicitly export a symbol
in your package that <code>testthat</code> can use to run your unit
tests. <code>testthat</code> will look for a routine with one of the names:</p>
<div class="sourceCode"><pre><code><span></span>
<span>    <span class="va">C_run_testthat_tests</span></span>
<span>    <span class="va">c_run_testthat_tests</span></span>
<span>    <span class="va">run_testthat_tests</span></span></code></pre></div>

<p>Assuming you have <code>useDynLib(&lt;pkg&gt;, .registration = TRUE)</code> in your package's
<code>NAMESPACE</code> file, this implies having routine registration code of the form:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> The definition <span class="cf">for</span> this <span class="cf">function</span> comes from the file <span class="st">'src/test-runner.cpp'</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> which is generated via <span class="st">`</span><span class="at">testthat::use_catch()</span><span class="st">`</span>.</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>extern SEXP <span class="fu">run_testthat_tests</span>();</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>static const R_CallMethodDef callMethods[] <span class="ot">=</span> {</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> other .Call method definitions,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  {<span class="st">"run_testthat_tests"</span>, (DL_FUNC) <span class="sc">&amp;</span>run_testthat_tests, <span class="dv">0</span>},</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  {<span class="cn">NULL</span>, <span class="cn">NULL</span>, <span class="dv">0</span>}</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>};</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>void R_init_<span class="sc">&lt;</span>pkg<span class="sc">&gt;</span>(DllInfo<span class="sc">*</span> dllInfo) {</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="fu">R_registerRoutines</span>(dllInfo, <span class="cn">NULL</span>, callMethods, <span class="cn">NULL</span>, <span class="cn">NULL</span>);</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="fu">R_useDynamicSymbols</span>(dllInfo, <span class="cn">FALSE</span>);</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>replacing <code>&lt;pkg&gt;</code> above with the name of your package, as appropriate.</p>
<p>See <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Controlling-visibility" class="external-link">Controlling Visibility</a>
and <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Registering-symbols" class="external-link">Registering Symbols</a>
in the <strong>Writing R Extensions</strong> manual for more information.</p>
    </div>
    <div class="section level2">
    <h2 id="advanced-usage">Advanced Usage<a class="anchor" aria-label="anchor" href="#advanced-usage"></a></h2>



<p>If you'd like to write your own Catch test runner, you can
instead use the <code>testthat::catchSession()</code> object in a file
with the form:</p>
<div class="sourceCode"><pre><code>
#define TESTTHAT_TEST_RUNNER
#include &lt;testthat.h&gt;

void run()
{
    Catch::Session&amp; session = testthat::catchSession();
    // interact with the session object as desired
}
</code></pre></div>

<p>This can be useful if you'd like to run your unit tests
with custom arguments passed to the Catch session.</p>
    </div>
    <div class="section level2">
    <h2 id="standalone-usage">Standalone Usage<a class="anchor" aria-label="anchor" href="#standalone-usage"></a></h2>



<p>If you'd like to use the C++ unit testing facilities provided
by Catch, but would prefer not to use the regular <code>testthat</code>
<span style="R">R</span> testing infrastructure, you can manually run the unit tests
by inserting a call to:</p>
<div class="sourceCode"><pre><code>
.Call("run_testthat_tests", PACKAGE = &lt;pkgName&gt;)
</code></pre></div>

<p>as necessary within your unit test suite.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="https://github.com/catchorg/Catch2/blob/master/docs/assertions.md" class="external-link">Catch</a>,
the library used to enable C++ unit testing.</p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer></body></html>

